spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ============================================
# Explicit Routes with Circuit Breaker
# ============================================

# Inventory Service Route with Circuit Breaker
spring.cloud.gateway.routes[0].id=inventory-service
spring.cloud.gateway.routes[0].uri=lb://INVENTORY-SERVICE
spring.cloud.gateway.routes[0].predicates[0]=Path=/inventory-service/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[0].filters[1]=CircuitBreaker=name=inventoryCircuitBreaker,fallbackUri=forward:/fallback/inventory

# Customer Service Route with Circuit Breaker
spring.cloud.gateway.routes[1].id=customer-service
spring.cloud.gateway.routes[1].uri=lb://CUSTOMER-SERVICE
spring.cloud.gateway.routes[1].predicates[0]=Path=/customer-service/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[1].filters[1]=CircuitBreaker=name=customerCircuitBreaker,fallbackUri=forward:/fallback/customers

# Billing Service Route with Circuit Breaker
spring.cloud.gateway.routes[2].id=billing-service
spring.cloud.gateway.routes[2].uri=lb://BILLING-SERVICE
spring.cloud.gateway.routes[2].predicates[0]=Path=/billing-service/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[2].filters[1]=CircuitBreaker=name=billingCircuitBreaker,fallbackUri=forward:/fallback/billing

# AI Service Route (Direct URL - AI service disabled Eureka)
spring.cloud.gateway.routes[3].id=ai-service
spring.cloud.gateway.routes[3].uri=http://ai-service:8085
spring.cloud.gateway.routes[3].predicates[0]=Path=/ai/**
spring.cloud.gateway.routes[3].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[3].filters[1]=RewritePath=/ai/(?<segment>.*), /api/ai/${segment}
# CircuitBreaker config optional or can be added back if defined in resilience4j sections



# ============================================
# Resilience4j Circuit Breaker Configuration
# ============================================
resilience4j.circuitbreaker.configs.default.slidingWindowSize=10
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=10000
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.configs.default.slowCallDurationThreshold=2000
resilience4j.circuitbreaker.configs.default.slowCallRateThreshold=50

# AI-specific circuit breaker config (longer timeout for LLM calls)
resilience4j.circuitbreaker.configs.ai.slidingWindowSize=5
resilience4j.circuitbreaker.configs.ai.failureRateThreshold=50
resilience4j.circuitbreaker.configs.ai.waitDurationInOpenState=30000
resilience4j.circuitbreaker.configs.ai.permittedNumberOfCallsInHalfOpenState=2
resilience4j.circuitbreaker.configs.ai.slowCallDurationThreshold=30000
resilience4j.circuitbreaker.configs.ai.slowCallRateThreshold=80

# Apply default config to all circuit breakers
resilience4j.circuitbreaker.instances.inventoryCircuitBreaker.baseConfig=default
resilience4j.circuitbreaker.instances.customerCircuitBreaker.baseConfig=default
resilience4j.circuitbreaker.instances.billingCircuitBreaker.baseConfig=default
resilience4j.circuitbreaker.instances.aiCircuitBreaker.baseConfig=ai

# Timeout Configuration
resilience4j.timelimiter.configs.default.timeoutDuration=3s
resilience4j.timelimiter.configs.ai.timeoutDuration=60s
resilience4j.timelimiter.instances.inventoryCircuitBreaker.baseConfig=default
resilience4j.timelimiter.instances.customerCircuitBreaker.baseConfig=default
resilience4j.timelimiter.instances.billingCircuitBreaker.baseConfig=default
resilience4j.timelimiter.instances.aiCircuitBreaker.baseConfig=ai