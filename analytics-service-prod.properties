# ============================================
# Analytics Service - Production Configuration
# ============================================
server.port=8084

# ============================================
# Eureka Discovery Client (Docker)
# ============================================
eureka.client.service-url.defaultZone=http://discovery-service:8761/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${random.uuid}

# ============================================
# Actuator Endpoints (Restricted in Production)
# ============================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when_authorized

# ============================================
# Kafka Binder Configuration (Docker Network)
# ============================================
spring.cloud.stream.kafka.binder.brokers=kafka:9092
spring.cloud.stream.kafka.binder.auto-create-topics=true
spring.cloud.stream.kafka.binder.replication-factor=1

# ============================================
# Topics Configuration (facture-topic, visite-topic)
# ============================================
# Consumer - Écoute sur visite-topic
spring.cloud.stream.bindings.pageEventConsumer-in-0.destination=visite-topic
spring.cloud.stream.bindings.pageEventConsumer-in-0.group=analytics-group
spring.cloud.stream.bindings.pageEventConsumer-in-0.content-type=application/json

# Supplier - Publie sur visite-topic (faster for prod)
spring.cloud.stream.bindings.pageEventSupplier-out-0.destination=visite-topic
spring.cloud.stream.bindings.pageEventSupplier-out-0.content-type=application/json
spring.cloud.stream.bindings.pageEventSupplier-out-0.producer.poller.fixed-delay=200

# Kafka Streams - visite-topic → Processing → facture-topic
spring.cloud.stream.bindings.kStream-in-0.destination=visite-topic
spring.cloud.stream.bindings.kStream-out-0.destination=facture-topic

# ============================================
# Kafka Streams Binder Configuration
# ============================================
spring.cloud.stream.kafka.streams.binder.brokers=kafka:9092
spring.cloud.stream.kafka.streams.binder.configuration.commit.interval.ms=500
spring.cloud.stream.kafka.streams.binder.configuration.default.key.serde=org.apache.kafka.common.serialization.Serdes$StringSerde
spring.cloud.stream.kafka.streams.binder.configuration.default.value.serde=org.apache.kafka.common.serialization.Serdes$StringSerde
spring.cloud.stream.kafka.streams.binder.application-id=analytics-kstream-prod

# ============================================
# Function Definitions (API Fonctionnelle)
# ============================================
spring.cloud.function.definition=pageEventConsumer;pageEventSupplier;kStream

# ============================================
# Production Logging
# ============================================
logging.level.org.springframework.cloud.stream=WARN
logging.level.org.apache.kafka=WARN
